<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
  </head>
  <body style="margin: 10px">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <button type="submit" class="btn btn-primary">
        <a href="{% url 'get_data' %}" style="color: white">GET NEW DATA</a>
      </button>
      <button type="submit" class="btn btn-primary m-3">
        <a href="{% url 'save_table' %}" style="color: white">Save Table</a>
      </button>

      <ul>
        <li class="nav-link"><a href="{% url 'charts' %}">Charts</a></li>
      </ul>
    </nav>

    <table class="table">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">Job Url</th>
          <th scope="col">Job Title</th>
          <th scope="col">Job Location</th>
          <th scope="col">Posted Date</th>
          <th scope="col">Company Name</th>
          <th scope="col">Company URL</th>
          <th scope="col">Country</th>
          <th scope="col">City</th>
          <th scope="col">Postal Code</th>
          <th scope="col">industries</th>
          <th scope="col">Founded Date</th>
          <th scope="col">Phone Number</th>
          <th scope="col">Number Of Employees</th>
        </tr>
      </thead>
      <tbody>
        {% for job in get_jobs%}
        <tr>
          <th scope="row">{{ forloop.counter }}</th>
          <td>{{job.job_url}}</td>
          <td>{{job.job_title}}</td>
          <td>{{job.job_location}}</td>
          <td>{{job.posted_date}}</td>
          <td>{{job.company_name}}</td>
          <td>
            <a
              href="{{job.company_url}}"
              target="_blank"
              id="company_url"
              data-url="{{job.company_url}}"
              data-name="{{job.company_name}}"
              >{{job.company_url}}</a
            >
          </td>
          <td>{{job.job_location}}</td>
          <td>{{job.country}}</td>
          <td>{{job.postal_code}}</td>
          <td>{{job.industries}}</td>
          <td>{{job.found_date}}</td>
          <td>{{job.phone}}</td>
          <td>{{job.number_of_employees}}</td>
        </tr>
        {%endfor%}
      </tbody>
    </table>
    <script>
      const urls = document.querySelectorAll("#company_url");
      urls.forEach((url) => {
        url.addEventListener("click", function (e) {
          e.preventDefault();
          const urlCompany = e.target.dataset.url;
          const companyName = e.target.dataset.name;
          window.open(urlCompany);
          window.open(`http://127.0.0.1:10000/change-email/${companyName}/`);
        });
      });
    </script>
  </body>
</html>
